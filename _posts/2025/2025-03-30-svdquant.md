---
layout: article
title: "SVDQuant and Nunchaku"
category: "mlsys"
tag: "mlsys"
comment: true
key: 20250209
mathjax: true
---

$$
    Q_X = round(X / s_X)
$$

$s_X = max(|X|) / q_{max}$ and $q_{max} = \text{possible max value in repr}$

$$
    Q(X) = \text{dequantization of }X = s_X Q_X
$$

$XW$ can be approximated

$$
    XW = Q(X)Q(W) = S_X S_W Q_X Q_W
$$

SVDQuant has introduces two path quantization

let's introduce a smoothing factor $\bold{\lambda}$
$$
\hat {X} = X diag(\bold{\lambda})^{-1}
$$

then

$XW = \hat {X} W diag({\bold{\lambda}}) = \hat{X} \hat{W}$,

use SVD to decompose $\hat{W} = L_1 L_2 + R$, where $L_1 = S\Sigma$, and $L_2 = V$

$$
    XW = \hat{X} \hat{W} = \hat{X} L_1 L_2 + \hat{X} R
$$

-  L1, L2 has low-rank (32 in actual implementations), preserve it in 16 bits.
- Quantize $\hat{X}$ and $R$ W4A4 ways.


This is open sourced in (https://github.com/mit-han-lab/nunchaku). I'm also a maintainer of the project, responsible to python engine related stuffs such as caching or adding new modules. In [my last post]({{"Thoughts/2025/02/09/getting-involved" | absolute_url}}), I want to get involved with some projects and contribute, chance came already.